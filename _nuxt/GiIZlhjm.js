import{_ as xt}from"./CYeIyjzW.js";import{_ as ht}from"./NxUEi_18.js";import{s as G,t as nt}from"./B6qCbaoP.js";import{z as _t,V as bt,f as st,m as kt,G as at,g as wt,h as I,n as Vt,p as ut,q as Mt,r as F,o as O,c as $,b as x,w as _,s as v,v as j,F as It,j as At,t as St,d as A,i as Q,x as W,l as jt,k as qt,a as Y}from"./B29pliZ2.js";import{b as rt,a as Ot}from"./DxPSARot.js";import{f as ot}from"./D2nGpDRe.js";import{l as Rt}from"./ntdiYfc-.js";import{i as lt}from"./D-2-6Lyj.js";import{_ as Ut}from"./DlAUqK2U.js";import"./CTRyl4Lp.js";function it(f,b,p){f=+f,b=+b,p=(u=arguments.length)<2?(b=f,f=0,1):u<3?1:+p;for(var n=-1,u=Math.max(0,Math.ceil((b-f)/p))|0,w=new Array(u);++n<u;)w[n]=f+n*p;return w}function dt(){var f=_t().unknown(void 0),b=f.domain,p=f.range,n=0,u=1,w,k,q=!1,e=0,V=0,S=.5;delete f.unknown;function y(){var s=b().length,R=u<n,c=R?u:n,z=R?n:u;w=(z-c)/Math.max(1,s-e+V*2),q&&(w=Math.floor(w)),c+=(z-c-w*(s-e))*S,k=w*(1-e),q&&(c=Math.round(c),k=Math.round(k));var L=it(s).map(function(P){return c+w*P});return p(R?L.reverse():L)}return f.domain=function(s){return arguments.length?(b(s),y()):b()},f.range=function(s){return arguments.length?([n,u]=s,n=+n,u=+u,y()):[n,u]},f.rangeRound=function(s){return[n,u]=s,n=+n,u=+u,q=!0,y()},f.bandwidth=function(){return k},f.step=function(){return w},f.round=function(s){return arguments.length?(q=!!s,y()):q},f.padding=function(s){return arguments.length?(e=Math.min(1,V=+s),y()):e},f.paddingInner=function(s){return arguments.length?(e=Math.min(1,s),y()):e},f.paddingOuter=function(s){return arguments.length?(V=+s,y()):V},f.align=function(s){return arguments.length?(S=Math.max(0,Math.min(1,s)),y()):S},f.copy=function(){return dt(b(),[n,u]).round(q).paddingInner(e).paddingOuter(V).align(S)},bt.apply(y(),arguments)}const Ct=["value"],$t=["width"],Nt=["width","height"],zt=["width"],T=100,Bt=st({__name:"Leaderboard",props:kt({repositories:{type:Array[String],default:()=>["chromium"]},grouping:{type:String,default:"yearly"},kind:{type:String,default:"author"}},{timeIndex:{},timeIndexModifiers:{}}),emits:["update:timeIndex"],setup(f){const{$usersInfo:b}=at(),{$color:p}=at();let n=wt(f,"timeIndex");const u=f,w=I(null),k=I(null),q=I(null),e=I(null);I("instant");const V=I(300),S=I(300),y=I([]),s=I(!1);Vt(()=>{switch(u.grouping){case"forever":return"Forever";case"yearly":return"Year";case"decennial":return"Decade";case"quarterly":return"Quarter";case"monthly":return"Month"}return"N/A"});const R=i=>{const t={};for(const r of i)Object.entries(r).forEach(([a,o])=>{t[a]||(t[a]={}),Object.entries(o).forEach(([l,d])=>{var m;(m=t[a])[l]||(m[l]=0),t[a][l]+=d})});return t},c=i=>{const t=[],r=Object.keys(i),a=new Set;for(const o of r)for(const l of Object.keys(i[o]))a.add(l);y.value=Array.from(a).sort((o,l)=>o<l?1:-1),n.value>=y.value.length&&(n.value=y.value.length-1);for(const o of y.value){const l={date:o,users:[]};for(const d of r)i[d][o]&&l.users.push([d,i[d][o]]);l.users.sort((d,m)=>m[1]-d[1]),l.users.splice(T*2),t.push(l)}return t},z=async()=>{s.value=!1;const i=await Promise.all(u.repositories.map(l=>b(l,u.grouping,u.kind))),t=R(i),r=c(t);r.sort((l,d)=>d.date>l.date?-1:1);const a=nt().duration(500),o=Math.min(Math.max(n.value,0),r.length-1);n.value!=o&&(n.value=o),Z(r[r.length-n.value-1],a)},L=i=>{const t=i.append("g");return(r,a)=>{const o=rt(r).ticks(V.value/100).tickSizeOuter(0).tickSizeInner(-S.value+100).tickFormat(l=>ot(".2s")(l).replace("G","B"));t.transition(a).call(o),t.select(".tick:first-of-type text").remove(),t.selectAll(".tick:not(:first-of-type) line").attr("stroke","white"),t.select(".domain").remove(),t.attr("opacity",.2)}},P=i=>{const t=i.append("g").attr("transform","translate(0, 30)");return(r,a)=>{const o=rt(r).ticks(V.value/100);t.transition(a).call(o)}},mt=i=>{const t=i.append("g");return(r,a,o,l)=>{const d=o.users.length,m=h=>h.transition(l).attr("transform",(g,C)=>`translate(0, ${a(C)})`).attr("opacity",1),M=h=>h.transition(l).attr("width",g=>r(g[1])-r(0)),U=h=>h.transition(l).attr("x",g=>r(g[1])+(r(g[1])<80?7:-7)).attr("text-anchor",g=>r(g[1])<80?"start":"end").text(g=>g[0]),D=h=>h.transition(l).attr("x",g=>r(g[1])+(r(g[1])<80?7:-7)).attr("text-anchor",g=>r(g[1])<80?"start":"end").textTween(function(g){const C=g[1];this._current||(this._current=0);const B=lt(this._current,C);return this._current=C,E=>{const N=Math.round(B(E));return N<100?Math.round(N):ot(".3s")(N)}}),et=h=>h.transition(l).textTween(function(g,C){const B=C+1;this._current||(this._current=0);const E=lt(this._current,B);return this._current=B,N=>Math.round(E(N))});t.selectAll("g").data(o.users.slice(0,T),h=>h[0]).join(h=>{const g=h.append("g");return g.attr("transform",`translate(1, ${a.bandwidth()*d})`).attr("opacity",0).call(m),g.append("rect").attr("fill",yt=>p(yt[0])).attr("opacity",.5).attr("x",r(0)).attr("height",a.bandwidth()).call(M),g.append("text").classed("index",!0).attr("fill","black").attr("dy","0.35em").attr("dx",0).attr("dy",a.bandwidth()/2).attr("alignment-baseline","middle").call(et),g.append("text").classed("name",!0).attr("fill","black").attr("dy","0.35em").attr("dx",5).attr("y",10).call(U),g.append("text").classed("commit",!0).attr("fill","gray").attr("dy","0.35em").attr("dx",5).attr("y",30).text(0).call(D),g},h=>(h.call(m),h.select("rect").call(M),h.select(".index").call(et),h.select(".name").call(U),h.select(".commit").call(D),h),h=>{const g=h;return h.transition(l).attr("transform",`translate(1, ${a.bandwidth()*d})`).attr("opacity",0).remove(),g})}},ct=(i,t=10)=>{const r=[];for(let a=0;a<i.length-1;a++){r.push(i[a]);const o={},l={};for(const[m,M]of i[a].users)o[m]=M;for(const[m,M]of i[a+1].users)l[m]=M;const d=new Set([...Object.keys(o),...Object.keys(l)]);for(let m=1;m<t;m++){const M=[];for(const U of d)M.push([U,(t-m)/t*(o[U]||0)+(0+m)/t*(l[U]||0)]);M.sort((U,D)=>D[1]-U[1]),r.push({date:i[a].date,users:M})}}return r.push(i[i.length-1]),r},pt=i=>{const t={};for(const r of i){for(const[a,o]of r.users)t[a]||(t[a]=0),t[a]+=o;r.users=[];for(const[a,o]of Object.entries(t))r.users.push([a,o]);r.users.sort((a,o)=>o[1]-a[1])}},H=async(i=!1)=>{if(s.value){s.value=!1;return}const t=await Promise.all(u.repositories.map(m=>b(m,u.grouping,u.kind))),r=R(t),a=c(r);a.sort((m,M)=>m.date>M.date?-1:1),a.length=Math.min(a.length,Math.max(2,n.value+1)),a.sort((m,M)=>m.date<M.date?-1:1),i&&pt(a);let o=0;const l=5,d=ct(a,l);for(o*=l,s.value=!0;o<d.length-1&&s.value;){o++;const m=nt().duration(2e3/l).ease(Rt);Z(d[o],m),await m.end()}s.value=!1},ft=()=>{s.value=!1},gt=()=>{n.value=Math.min(n.value+1,y.value.length-1)},vt=()=>{n.value=Math.max(n.value-1,0)};ut(u,z);let J=null,K=null,X=null;const Z=(i,t)=>{if(!i)return;const r=d=>d.attr("x",V.value-10).attr("y",48).transition(t).text(m=>m);G(e.value).selectAll("text").data([i.date],d=>d).join(d=>{const m=d.append("text");return m.text(M=>M).attr("text-anchor","end").attr("transform","translate(0, 32)").attr("opacity",0).attr("font-size","2em"),m.transition(t).attr("transform","translate(0, 0)").attr("opacity",1),r(m)},d=>r(d.transition(t)),d=>d.transition(t).attr("transform","translate(0, -32)").attr("opacity",0).remove());const a=Math.max(...i.users.map(d=>d[1])),o=Ot().domain([0,a]).range([25,V.value-10]),l=dt().domain(it(T+1)).range([0,S.value-60]).padding(.1);J(o,l,i,t),K(o,t),X(o,t)},tt=()=>{w.value&&(V.value=w.value.clientWidth,S.value=T*50,z())};return window.addEventListener("resize",tt),Mt(()=>{J=mt(G(k.value)),K=L(G(k.value)),X=P(G(q.value)),tt()}),(i,t)=>{const r=F("b-field"),a=F("b-select"),o=F("b-button");return O(),$("div",{ref_key:"container",ref:w,align:"center"},[x(r,{grouped:"","group-multiline":"",label:"time"},{default:_(()=>[x(r),x(r,null,{default:_(()=>[x(a,{modelValue:v(n),"onUpdate:modelValue":t[0]||(t[0]=l=>j(n)?n.value=l:n=l)},{default:_(()=>[(O(!0),$(It,null,At(v(y),(l,d)=>(O(),$("option",{key:d,value:d},St(l),9,Ct))),128))]),_:1},8,["modelValue"])]),_:1}),x(r,{grouped:""},{default:_(()=>[x(o,{onClick:gt,disabled:v(n)==v(y).length-1},{default:_(()=>t[3]||(t[3]=[A(" Previous ")])),_:1},8,["disabled"]),x(o,{onClick:vt,disabled:v(n)==0},{default:_(()=>t[4]||(t[4]=[A(" Next ")])),_:1},8,["disabled"])]),_:1}),!v(s)&&f.grouping!="forever"&&v(n)>0?(O(),Q(r,{key:0},{default:_(()=>[x(o,{onClick:t[1]||(t[1]=l=>H(!1)),class:"is-success"},{default:_(()=>t[5]||(t[5]=[A(" Animate ")])),_:1})]),_:1})):W("",!0),!v(s)&&f.grouping!="forever"&&v(n)>0?(O(),Q(r,{key:1},{default:_(()=>[x(o,{onClick:t[2]||(t[2]=l=>H(!0)),class:"is-warning"},{default:_(()=>t[6]||(t[6]=[A(" Animate with accumulation ")])),_:1})]),_:1})):W("",!0),v(s)?(O(),Q(r,{key:2},{default:_(()=>[x(o,{onClick:ft,class:"is-danger"},{default:_(()=>t[7]||(t[7]=[A(" Stop ")])),_:1})]),_:1})):W("",!0)]),_:1}),(O(),$("svg",{ref_key:"svg_axis",ref:q,width:v(V),height:31,class:"sticky-top"},null,8,$t)),(O(),$("svg",{ref_key:"svg",ref:k,width:v(V),height:v(S)},null,8,Nt)),(O(),$("svg",{ref_key:"svg_title",ref:e,width:v(V),height:80,class:"sticky-bottom"},null,8,zt))],512)}}}),Ft=Ut(Bt,[["__scopeId","data-v-9ee442ea"]]),Lt={class:"section"},Dt={class:"container"},Xt=st({__name:"leaderboard",setup(f){const b=I(["chromium"]),p=I("yearly"),n=I("author"),u=I(0),w=jt(),k=qt();return k.query.repositories&&(b.value=k.query.repositories.split(",")),k.query.grouping&&(p.value=k.query.grouping),k.query.kind&&(n.value=k.query.kind),k.query.timeIndex&&(u.value=parseInt(k.query.timeIndex)),ut([b,p,n,u],()=>{w.replace({query:{repositories:b.value.join(","),grouping:p.value,kind:n.value,timeIndex:u.value.toString()}})}),(q,e)=>{const V=xt,S=ht,y=F("b-radio-button"),s=F("b-field"),R=Ft;return O(),$("div",null,[x(V),Y("section",Lt,[Y("div",Dt,[e[18]||(e[18]=Y("h1",{class:"title"},"Leaderboard",-1)),x(S,{modelValue:v(b),"onUpdate:modelValue":e[0]||(e[0]=c=>j(b)?b.value=c:null),size:"medium",allowMultiple:!0,allowAll:!0},null,8,["modelValue"]),x(s,{grouped:"","group-multiline":""},{default:_(()=>[x(s,{label:"As:"},{default:_(()=>[x(y,{name:"kind",modelValue:v(n),"onUpdate:modelValue":e[1]||(e[1]=c=>j(n)?n.value=c:null),"native-value":"author"},{default:_(()=>e[10]||(e[10]=[A(" author ")])),_:1},8,["modelValue"]),x(y,{name:"kind",modelValue:v(n),"onUpdate:modelValue":e[2]||(e[2]=c=>j(n)?n.value=c:null),"native-value":"review"},{default:_(()=>e[11]||(e[11]=[A(" Review ")])),_:1},8,["modelValue"]),x(y,{name:"kind",modelValue:v(n),"onUpdate:modelValue":e[3]||(e[3]=c=>j(n)?n.value=c:null),"native-value":"both"},{default:_(()=>e[12]||(e[12]=[A(" both ")])),_:1},8,["modelValue"])]),_:1}),x(s,{label:"Grouping:"},{default:_(()=>[x(y,{name:"grouping",modelValue:v(p),"onUpdate:modelValue":e[4]||(e[4]=c=>j(p)?p.value=c:null),"native-value":"forever"},{default:_(()=>e[13]||(e[13]=[A(" Forever ")])),_:1},8,["modelValue"]),x(y,{name:"grouping",modelValue:v(p),"onUpdate:modelValue":e[5]||(e[5]=c=>j(p)?p.value=c:null),"native-value":"decennial"},{default:_(()=>e[14]||(e[14]=[A(" Decennial ")])),_:1},8,["modelValue"]),x(y,{name:"grouping",modelValue:v(p),"onUpdate:modelValue":e[6]||(e[6]=c=>j(p)?p.value=c:null),"native-value":"yearly"},{default:_(()=>e[15]||(e[15]=[A(" Yearly ")])),_:1},8,["modelValue"]),x(y,{name:"grouping",modelValue:v(p),"onUpdate:modelValue":e[7]||(e[7]=c=>j(p)?p.value=c:null),"native-value":"quarterly"},{default:_(()=>e[16]||(e[16]=[A(" Quarterly ")])),_:1},8,["modelValue"]),x(y,{name:"grouping",modelValue:v(p),"onUpdate:modelValue":e[8]||(e[8]=c=>j(p)?p.value=c:null),"native-value":"monthly"},{default:_(()=>e[17]||(e[17]=[A(" Monthly ")])),_:1},8,["modelValue"])]),_:1})]),_:1}),x(R,{repositories:v(b),grouping:v(p),kind:v(n),timeIndex:v(u),"onUpdate:timeIndex":e[9]||(e[9]=c=>j(u)?u.value=c:null)},null,8,["repositories","grouping","kind","timeIndex"])])])])}}});export{Xt as default};
