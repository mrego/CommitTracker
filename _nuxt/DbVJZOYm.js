import{_ as ft}from"./CYeIyjzW.js";import{_ as dt}from"./CDkg2K4h.js";import{t as Q,s as b}from"./B6qCbaoP.js";import{f as pt,k as gt,l as yt,h as B,z as ht,A as mt,q as kt,p as vt,o as nt,c as et,b as ot,a as h,t as rt,s as q,v as wt}from"./B29pliZ2.js";import{f as st}from"./D2nGpDRe.js";import{p as X,a as xt}from"./Bl_BFuLA.js";import{_ as _t}from"./DlAUqK2U.js";function Y(i){return((i*=2)<=1?i*i:--i*(2-i)+1)/2}function at(i,l){let u;if(l===void 0)for(const c of i)c!=null&&(u<c||u===void 0&&c>=c)&&(u=c);else{let c=-1;for(let f of i)(f=l(f,++c,i))!=null&&(u<f||u===void 0&&f>=f)&&(u=f)}return u}function Lt(i,l){let u;if(l===void 0)for(const c of i)c!=null&&(u>c||u===void 0&&c>=c)&&(u=c);else{let c=-1;for(let f of i)(f=l(f,++c,i))!=null&&(u>f||u===void 0&&f>=f)&&(u=f)}return u}function Z(i,l){let u=0;if(l===void 0)for(let c of i)(c=+c)&&(u+=c);else{let c=-1;for(let f of i)(f=+l(f,++c,i))&&(u+=f)}return u}function bt(i){return i.depth}function St(i,l){return i.sourceLinks.length?i.depth:l-1}function H(i){return function(){return i}}function it(i,l){return F(i.source,l.source)||i.index-l.index}function lt(i,l){return F(i.target,l.target)||i.index-l.index}function F(i,l){return i.y0-l.y0}function tt(i){return i.value}function Bt(i){return i.index}function Nt(i){return i.nodes}function Tt(i){return i.links}function ct(i,l){const u=i.get(l);if(!u)throw new Error("missing: "+l);return u}function ut({nodes:i}){for(const l of i){let u=l.y0,c=u;for(const f of l.sourceLinks)f.y0=u+f.width/2,u+=f.width;for(const f of l.targetLinks)f.y1=c+f.width/2,c+=f.width}}function It(){let i=0,l=0,u=1,c=1,f=24,j=8,y,M=Bt,z=St,S,L,N=Nt,A=Tt,m=6;function p(){const e={nodes:N.apply(null,arguments),links:A.apply(null,arguments)};return D(e),P(e),E(e),x(e),I(e),ut(e),e}p.update=function(e){return ut(e),e},p.nodeId=function(e){return arguments.length?(M=typeof e=="function"?e:H(e),p):M},p.nodeAlign=function(e){return arguments.length?(z=typeof e=="function"?e:H(e),p):z},p.nodeSort=function(e){return arguments.length?(S=e,p):S},p.nodeWidth=function(e){return arguments.length?(f=+e,p):f},p.nodePadding=function(e){return arguments.length?(j=y=+e,p):j},p.nodes=function(e){return arguments.length?(N=typeof e=="function"?e:H(e),p):N},p.links=function(e){return arguments.length?(A=typeof e=="function"?e:H(e),p):A},p.linkSort=function(e){return arguments.length?(L=e,p):L},p.size=function(e){return arguments.length?(i=l=0,u=+e[0],c=+e[1],p):[u-i,c-l]},p.extent=function(e){return arguments.length?(i=+e[0][0],u=+e[1][0],l=+e[0][1],c=+e[1][1],p):[[i,l],[u,c]]},p.iterations=function(e){return arguments.length?(m=+e,p):m};function D({nodes:e,links:a}){for(const[s,o]of e.entries())o.index=s,o.sourceLinks=[],o.targetLinks=[];const r=new Map(e.map((s,o)=>[M(s,o,e),s]));for(const[s,o]of a.entries()){o.index=s;let{source:t,target:n}=o;typeof t!="object"&&(t=o.source=ct(r,t)),typeof n!="object"&&(n=o.target=ct(r,n)),t.sourceLinks.push(o),n.targetLinks.push(o)}if(L!=null)for(const{sourceLinks:s,targetLinks:o}of e)s.sort(L),o.sort(L)}function P({nodes:e}){for(const a of e)a.value=a.fixedValue===void 0?Math.max(Z(a.sourceLinks,tt),Z(a.targetLinks,tt)):a.fixedValue}function E({nodes:e}){const a=e.length;let r=new Set(e),s=new Set,o=0;for(;r.size;){for(const t of r){t.depth=o;for(const{target:n}of t.sourceLinks)s.add(n)}if(++o>a)throw new Error("circular link");r=s,s=new Set}}function x({nodes:e}){const a=e.length;let r=new Set(e),s=new Set,o=0;for(;r.size;){for(const t of r){t.height=o;for(const{source:n}of t.targetLinks)s.add(n)}if(++o>a)throw new Error("circular link");r=s,s=new Set}}function v({nodes:e}){const a=at(e,o=>o.depth)+1,r=(u-i-f)/(a-1),s=new Array(a);for(const o of e){const t=Math.max(0,Math.min(a-1,Math.floor(z.call(null,o,a))));o.layer=t,o.x0=i+t*r,o.x1=o.x0+f,s[t]?s[t].push(o):s[t]=[o]}if(S)for(const o of s)o.sort(S);return s}function T(e){const a=Lt(e,r=>(c-l-(r.length-1)*y)/Z(r,tt));for(const r of e){let s=l;for(const o of r){o.y0=s,o.y1=s+o.value*a,s=o.y1+y;for(const t of o.sourceLinks)t.width=t.value*a}s=(c-s+y)/(r.length+1);for(let o=0;o<r.length;++o){const t=r[o];t.y0+=s*(o+1),t.y1+=s*(o+1)}V(r)}}function I(e){const a=v(e);y=Math.min(j,(c-l)/(at(a,r=>r.length)-1)),T(a);for(let r=0;r<m;++r){const s=Math.pow(.99,r),o=Math.max(1-s,(r+1)/m);U(a,s,o),R(a,s,o)}}function R(e,a,r){for(let s=1,o=e.length;s<o;++s){const t=e[s];for(const n of t){let d=0,g=0;for(const{source:_,value:K}of n.targetLinks){let W=K*(n.layer-_.layer);d+=$(_,n)*W,g+=W}if(!(g>0))continue;let w=(d/g-n.y0)*a;n.y0+=w,n.y1+=w,J(n)}S===void 0&&t.sort(F),O(t,r)}}function U(e,a,r){for(let s=e.length,o=s-2;o>=0;--o){const t=e[o];for(const n of t){let d=0,g=0;for(const{target:_,value:K}of n.sourceLinks){let W=K*(_.layer-n.layer);d+=C(n,_)*W,g+=W}if(!(g>0))continue;let w=(d/g-n.y0)*a;n.y0+=w,n.y1+=w,J(n)}S===void 0&&t.sort(F),O(t,r)}}function O(e,a){const r=e.length>>1,s=e[r];G(e,s.y0-y,r-1,a),k(e,s.y1+y,r+1,a),G(e,c,e.length-1,a),k(e,l,0,a)}function k(e,a,r,s){for(;r<e.length;++r){const o=e[r],t=(a-o.y0)*s;t>1e-6&&(o.y0+=t,o.y1+=t),a=o.y1+y}}function G(e,a,r,s){for(;r>=0;--r){const o=e[r],t=(o.y1-a)*s;t>1e-6&&(o.y0-=t,o.y1-=t),a=o.y0-y}}function J({sourceLinks:e,targetLinks:a}){if(L===void 0){for(const{source:{sourceLinks:r}}of a)r.sort(lt);for(const{target:{targetLinks:r}}of e)r.sort(it)}}function V(e){if(L===void 0)for(const{sourceLinks:a,targetLinks:r}of e)a.sort(lt),r.sort(it)}function $(e,a){let r=e.y0-(e.sourceLinks.length-1)*y/2;for(const{target:s,width:o}of e.sourceLinks){if(s===a)break;r+=o+y}for(const{source:s,width:o}of a.targetLinks){if(s===e)break;r-=o}return r}function C(e,a){let r=a.y0-(a.targetLinks.length-1)*y/2;for(const{source:s,width:o}of a.targetLinks){if(s===e)break;r+=o+y}for(const{target:s,width:o}of e.sourceLinks){if(s===a)break;r-=o}return r}return p}const jt={class:"section"},Mt={class:"container"},zt=["width","height"],At={class:"timeline"},Dt={class:"container"},Vt=pt({__name:"reward_per_components",setup(i){const l=st("$,.0f"),u=st(".2%"),c=gt(),f=yt(),j=B(0),y=B(0),M=B(null),z=B(null),S=B(null),L=B(null),N=B(2e3),A=B(2e3),m=B([new Date("2015-01-01"),new Date]);c.query.start&&(m.value[0]=new Date(c.query.start)),c.query.end&&(m.value[1]=new Date(c.query.end));const p=()=>{f.push({query:{start:m.value[0].toISOString().split("T")[0],end:m.value[1].toISOString().split("T")[0]}})},D=ht(mt);let P={};kt(async()=>{P=await(await fetch("/cve/data.json")).json(),E()});const E=()=>{const x={nodes:[],links:[]},v={},T={},I=t=>(v[t]===void 0&&(v[t]=x.nodes.length,x.nodes.push({node:v[t],name:t})),v[t]),R=(t,n,d)=>{const g=`${t}-${n}`;T[g]===void 0&&(T[g]=x.links.length,x.links.push({source:t,target:n,value:0})),x.links[T[g]].value+=d};let U=0,O=0;const k={};for(const t of Object.values(P)){const n=new Date(t.bug_date);if(!(n<m.value[0]||n>m.value[1])){O+=isNaN(parseInt(t.vrp_reward))?0:parseInt(t.vrp_reward),U+=1;for(const d of t.components||[]){let g=isNaN(parseInt(t.vrp_reward))?0:parseInt(t.vrp_reward);g/=t.components.length,k[d]||(k[d]=0),k[d]+=g}}}j.value=U,y.value=O;for(const t in k)k[t]==0&&delete k[t];N.value=window.innerWidth,Object.entries(k).sort((t,n)=>t[0].localeCompare(n[0])).forEach(([t,n])=>{const d=t.split(">");let g=I("All");k.All||(k.All=0);for(let w=0;w<d.length;w++){const _=d.slice(0,w+1).join(">");R(g,I(_),n),g=I(_)}});for(const t of x.nodes){t.component=t.name;const n=t.name.split(">");t.name=n[n.length-1]}const V=It().nodeId(t=>t.node).nodeWidth(6).nodePadding(7).nodeAlign(bt).size([N.value-200,A.value-100]).nodeSort(null)(x),$=Q().duration(500).delay(300).ease(Y),C=Q().duration(200).ease(Y),e=Q().duration(200).ease(Y),a=t=>{t.attr("x",n=>n.x0).attr("y",n=>n.y0).attr("height",n=>n.y1-n.y0).attr("width",n=>n.x1-n.x0)};b(M.value).attr("transform","translate(100,50)").selectAll("rect").data(V.nodes,t=>t.component).join(t=>{const n=t.append("rect");return a(n),n.attr("fill",d=>D(d.component)).attr("opacity",0).attr("transform","translate(30,0)").transition($).attr("opacity",1).attr("transform","translate(0,0)"),n},t=>(t=t.transition(C),a(t),t),t=>{t=t.transition(e),t.attr("opacity",0),t.remove()});const r=t=>{t.attr("d",n=>{const d=(n.target.x0-n.source.x1)*.3,g=xt();return g.moveTo(n.source.x1,n.y0-n.width/2),g.bezierCurveTo(n.source.x1+d,n.y0-n.width/2,n.target.x0-d,n.y1-n.width/2,n.target.x0,n.y1-n.width/2),g.lineTo(n.target.x0,n.y1+n.width/2),g.bezierCurveTo(n.target.x0-d,n.y1+n.width/2,n.source.x1+d,n.y0+n.width/2,n.source.x1,n.y0+n.width/2),g.closePath(),g.toString()})};b(z.value).attr("opacity",.2).attr("transform","translate(100,50)").selectAll("path").data(V.links,t=>t.source.component+t.target.name).join(t=>{const n=t.append("path");return r(n),n.attr("fill",d=>D(d.source.component)).attr("opacity",0).attr("transform","translate(30,0)").transition($).attr("opacity",1).attr("transform","translate(0,0)"),n},t=>(t=t.transition(C),r(t),t),t=>{t=t.transition(e),t.attr("opacity",0),t.remove()}).on("mouseover",function(t,n){const[d,g]=X(t);X(t),b(this).attr("opacity",.5);const w=b(".tooltip").style("display","block").style("position","absolute").attr("transform",`translate(${d},${g})`).attr("pointer-events","none"),_=w.select("text").attr("font-size",20).attr("fill","black").attr("pointer-events","none").text(n.target.name+": "+l(n.value)+`
          (${u(n.value/y.value)})`);w.select("rect").attr("x",-10).attr("y",-30).attr("width",_.node().getBBox().width+20).attr("height",_.node().getBBox().height+20).attr("fill",D(n.source.component)).attr("rx",5).attr("ry",5).attr("pointer-events","none").attr("stroke","black").attr("stroke-width",1)}).on("mousemove",function(t){const[n,d]=X(t);b(".tooltip").attr("transform",`translate(${n},${d})`)}).on("mouseout",function(t,n){b(".tooltip").style("display","none"),b(this).attr("fill",D(n.source.component)),b(this).attr("opacity",1)});const s=t=>{t.attr("x",n=>n.x0+10).attr("y",n=>(n.y1+n.y0)/2).attr("text-anchor","start").attr("alignment-baseline","middle").text(n=>n.name).attr("font-size",n=>Math.max(Math.pow(n.y1-n.y0,.2)*5,10))};b(S.value).attr("transform","translate(100,50)").selectAll("text").data(V.nodes,t=>t.component).join(t=>{const n=t.append("text");return s(n),n.attr("opacity",0).attr("transform","translate(30,0)").transition($).attr("opacity",1).attr("transform","translate(0,0)"),n},t=>(t=t.transition(C),s(t),t),t=>{t=t.transition(e),t.attr("opacity",0),t.remove()});const o=t=>{t.attr("transform",n=>`translate(${n.target.x0-10}, ${(n.target.y1+n.target.y0)/2})`).attr("font-size",n=>Math.max(Math.pow(n.target.y1-n.target.y0,.2)*5,10)).text(n=>l(n.value))};b(L.value).attr("transform","translate(100,50)").selectAll("text").data(V.links,t=>t.source.component+t.target.component).join(t=>{const n=t.append("text");return n.attr("text-anchor","end"),n.attr("alignment-baseline","middle"),o(n),n.attr("opacity",0).transition($).attr("opacity",1),n},t=>(t=t.transition(C),o(t),t),t=>{t=t.transition(e),t.attr("opacity",0),t.remove()})};return vt(m,()=>{p(),E()}),window.addEventListener("resize",()=>{E()}),(x,v)=>{const T=ft,I=dt;return nt(),et("div",null,[ot(T),h("section",jt,[h("div",Mt,[v[1]||(v[1]=h("h1",{class:"title"}," VRP reward per component ",-1)),h("ul",null,[h("li",null,rt(q(j))+" CVEs",1),h("li",null,rt(q(l)(q(y)))+" total reward",1)])])]),h("section",null,[(nt(),et("svg",{width:q(N),height:q(A)},[h("g",{ref_key:"svg_labels",ref:S},null,512),h("g",{ref_key:"svg_link_labels",ref:L},null,512),h("g",{ref_key:"svg_nodes",ref:M},null,512),h("g",{ref_key:"svg_links",ref:z},null,512),v[2]||(v[2]=h("g",{class:"tooltip",style:{display:"none"}},[h("rect"),h("text")],-1))],8,zt))]),h("section",At,[h("div",Dt,[ot(I,{modelValue:q(m),"onUpdate:modelValue":v[0]||(v[0]=R=>wt(m)?m.value=R:null),minDate:new Date("2015-01-01")},null,8,["modelValue","minDate"])])])])}}}),Pt=_t(Vt,[["__scopeId","data-v-e3967fae"]]);export{Pt as default};
